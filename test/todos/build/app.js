// Generated by CoffeeScript 1.3.3
(function() {
  var app,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  __Model.Task = (function(_super) {

    __extends(Task, _super);

    function Task() {
      return Task.__super__.constructor.apply(this, arguments);
    }

    Task.configure("name", "done");

    Task.active = function() {
      return this.select(function(item) {
        return !item.done;
      });
    };

    Task.done = function() {
      return this.select(function(item) {
        return !!item.done;
      });
    };

    Task.destroyDone = function() {
      var instance, _i, _len, _ref;
      _ref = this.done();
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        instance = _ref[_i];
        instance.destroy();
      }
      return console.error(Task.all());
    };

    Task.prototype.validate = function() {
      if (!this.name) {
        return "name is required";
      }
    };

    return Task;

  })(Monocle.Model);

  __View.Task = (function(_super) {

    __extends(Task, _super);

    function Task() {
      return Task.__super__.constructor.apply(this, arguments);
    }

    Task.prototype.container = ".items";

    Task.prototype.template = "<div class=\"item {{#done}}done{{/done}}\">\n    <div class=\"view\" title=\"Double click to edit...\">\n        <input type=\"checkbox\" {{#done}}checked=\"checked\"{{/done}} />\n        <span>{{name}}</span> <a class=\"destroy\"></a>\n    </div>\n    <div class=\"edit\">\n        <input type=\"text\" value=\"{{name}}\">\n    </div>\n</div>";

    Task.prototype.events = {
      "dblclick       .view": "onEdit",
      "tap            .destroy": "onDestroy",
      "tap            input[type=checkbox]": "onCheck",
      "blur           input[type=text]": "onBlur"
    };

    Task.prototype.elements = {
      "input[type=checkbox]": "checkbox"
    };

    Task.prototype.onEdit = function(data) {
      this.el.addClass("editing");
      return this.input.focus();
    };

    Task.prototype.onBlur = function(event) {
      event.preventDefault();
      this.el.removeClass("editing");
      this.item.updateAttributes({
        name: this.input.val()
      });
      return this.refresh();
    };

    Task.prototype.onCheck = function(event) {
      var done;
      done = this.checkbox.attr('checked') === null ? "checked" : void 0;
      this.item.updateAttributes({
        done: done
      });
      return this.refresh();
    };

    Task.prototype.onDestroy = function() {
      return this.remove();
    };

    return Task;

  })(Monocle.View);

  __Controller.Task = (function(_super) {

    __extends(Task, _super);

    Task.prototype.events = {
      "click  form a": "onCreate",
      "click .clear": "onClear"
    };

    Task.prototype.elements = {
      "form input": "input",
      ".countVal": "count"
    };

    function Task() {
      this.bindChange = __bind(this.bindChange, this);

      this.bindCreate = __bind(this.bindCreate, this);

      this.bindDestroy = __bind(this.bindDestroy, this);

      this.bindError = __bind(this.bindError, this);
      Task.__super__.constructor.apply(this, arguments);
      __Model.Task.bind("create", this.bindCreate);
      __Model.Task.bind("change", this.bindChange);
      __Model.Task.bind("destroy", this.bindDestroy);
      __Model.Task.bind("error", this.bindError);
    }

    Task.prototype.bindError = function(task) {
      return console.error(arguments);
    };

    Task.prototype.bindDestroy = function(task) {
      console.error("controller task destroy", task, arguments);
      return alert(task.name);
    };

    Task.prototype.bindCreate = function(task) {
      var tasks, view;
      view = new __View.Task({
        item: task
      });
      tasks = [];
      tasks.push(task);
      tasks.push(task);
      return view.append(task);
    };

    Task.prototype.bindChange = function() {
      var active;
      active = __Model.Task.active().length;
      return this.count.text(active);
    };

    Task.prototype.onCreate = function(event) {
      event.preventDefault();
      __Model.Task.create({
        name: this.input.val()
      });
      this.input.val("");
      return console.error("tasks >> ", __Model.Task.all());
    };

    Task.prototype.onClear = function(event) {
      event.preventDefault();
      return __Model.Task.destroyDone();
    };

    return Task;

  })(Monocle.Controller);

  app = new __Controller.Task('#tasks');

  __Model.Task.create({
    name: "Cafe con Ina en el Laia"
  });

  __Model.Task.create({
    name: "Charla Ibermatica"
  });

  __Model.Task.create({
    name: "Volver a la oficina"
  });

  console.error(__Model.Task.all());

  console.error("==================================================================");

}).call(this);
